<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Immersive Volume Graphics: UnityVolumeRendering</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Immersive Volume Graphics
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="namespace_unity_volume_rendering.html">UnityVolumeRendering</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A volume renderer, made in Unity3D. I have written a <a href="https://matiaslavik.wordpress.com/2020/01/19/volume-rendering-in-unity/">tutorial explaining the basic implementation</a>. Have any questions? <a href="https://matiaslavik.wordpress.com/contact-me/">Find my contact info here</a>.</p>
<p>I also have <a href="https://bittube.video/videos/watch/d9f34e1e-ee05-41fe-85de-7429d76f5de1">a tutorial video that shows how to use the project</a></p>
<p><img src="https://github.com/mlavik1/UnityVolumeRendering/blob/master/Screenshots/front.jpg" alt="alt tag" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md791"></a>
Requirements:</h1>
<ul>
<li><a class="el" href="namespace_unity.html">Unity</a> 2018 1.5 or newer (should also work with some older versions, but I haven't tested)</li>
</ul>
<h1><a class="anchor" id="autotoc_md792"></a>
How to use sample scene</h1>
<ul>
<li>Open "TestScene.unity"</li>
<li>Click "Volume Rendering" in the menu bar</li>
<li>Select "Load Asset"</li>
<li>Pick a file in the "DataFiles" folder (I recommend manix.dat)</li>
<li>Click the "import"-button</li>
</ul>
<h1><a class="anchor" id="autotoc_md793"></a>
Step-by-step instructions</h1>
<p><b>1. Import model</b></p>
<p><b>Raw datasets:</b></p>
<p>In the menu bar, click "Volume Rendering" and "Load raw dataset"</p>
<p><img src="Screenshots/UnityVolumeRendering/menubar2.png" alt="" width="200px" class="inline"/></p>
<p>Then select the dataset you wish to import. Currently only raw datasets are supported (you can add your own importer for other datasets).</p>
<p>In the next menu you can optionally set the import setting for the raw dataset. For the sample files you don't need to change anything.</p>
<p><img src="Screenshots/UnityVolumeRendering/import.png" alt="" width="200px" class="inline"/></p>
<p><b>DICOM:</b></p>
<p>To import a DICOM dataset, click "Volume Rendering" and "Load DICOM" and select the folder containing your DICOM files. The dataset must be of 3D nature, and contain several files - each being a slice along the Z axis.</p>
<p><b>2. Moving the model</b></p>
<p>You can move the model like any other GameObject. Simply select it in the scene view or scene hierarchy, and move/rotate it like normal.</p>
<p><img src="Screenshots/UnityVolumeRendering/movement.gif" alt="" width="400px" class="inline"/></p>
<p><b>3. Changing the visualisation</b></p>
<p>Select the model and find the "Volume Render Object" in the inspector.</p>
<p><img src="Screenshots/UnityVolumeRendering/component-inspector.png" alt="" width="200px" class="inline"/></p>
<p>Here you can change the "Render mode":</p>
<p><img src="Screenshots/UnityVolumeRendering/rendermode.png" alt="" width="200px" class="inline"/></p>
<p>Example:</p>
<p><img src="Screenshots/UnityVolumeRendering/rendermodes.gif" alt="" width="500px" class="inline"/></p>
<p>There are 3 render modes:</p><ul>
<li>Direct Volume Rendering (using transfer functions)</li>
<li>Maximum Intensity Projection (shows the maximum density)</li>
<li>Isosurface Rendering</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md794"></a>
Direct Volume Rendering</h1>
<p>Direct volume rendering is the most standard rendering mode. It sends rays through the dataset, and uses "transfer functions" (1D or 2D) to determine the colour and opacity. Transfer functions map density (2D: also gradient magnitude) to a colour and opacity.</p><ul>
<li><b>Modifying transfer functions</b>: Click "Volume Rendering" in the menu bar and select "1D Transfer Function" or "2D Transfer Function"<ul>
<li><b>1D Transfer Function</b>: X-axis represents density and Y-axis represents alpha (opaccity). Move the grey alpha knots to create a curve for opacity by density. Right-click to add new alpha knots. The bottom gradient-coloured panel maps colour to density. Right-click to add new knots and click on an existing colour knot to modify its colour.</li>
<li><b>2D Transfer Function</b>: X-axis represents density and Y-axis represents gradient magnitude. Click "add rectangle" to add a new rectangle-shape. Move the four sliders (bottom left) to modify size/position. Modify the two sliders to the right to change min/max alpha/opacity. Each rectangle can have one colour (see colour picker).</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md795"></a>
Isosurface Rendering</h1>
<p>Isosurface rendering draws the first thing the ray hits, with a density higher than some threshold. You can set this threshold yourself, by selecting the object and changing the "Visible value range" in the inspector. These can also be used with direct volume rendering mode.</p>
<p><img src="Screenshots/UnityVolumeRendering/isosurface.gif" alt="" width="500px" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md796"></a>
(VR) performance</h1>
<p>Since VR requires two cameras to render each frame, you can expect worse performance. However, you can improve the FPS in two ways:</p><ul>
<li>Open <em>DirectVolumeRenderingShader.shader</em> and reduce the value of <em>NUM_STEPS</em> inthe <em>frag_dvr</em> function. This will sacrifice quality for performance.</li>
<li>Disable the DEPTHWRITE_ON shader variant. You can do this from code, or just remove the line "#pragma multi_compile DEPTHWRITE_ON DEPTHWRITE_OFF" in <em>DirectVolumeRenderingShader.shader</em>. Note: this will remove depth writing, so you won't be able to intersect multiple datasets.</li>
</ul>
<h1><a class="anchor" id="autotoc_md797"></a>
How to use in your own project</h1>
<ul>
<li>Create an instance of an importer (for example <em>RawDatasetImporter</em>):<br  />
 <code>DatasetImporterBase importer = new RawDatasetImporter(fileToImport, dimX, dimY, dimZ, DataContentFormat.Int16, 6);</code> (alternatively, use the <em>DICOMImporter</em>)</li>
<li>Call the Import()-function, which returns a Dataset:<br  />
 <code>VolumeDataset dataset = importer.Import();</code></li>
<li>Use <em>VolumeObjectFactory</em> to create an object from the dataset:<br  />
 <code>VolumeRenderedObject obj = VolumeObjectFactory.CreateObject(dataset);</code></li>
</ul>
<p>See "DatasetImporterEditorWindow.cs" for an example.</p>
<h1><a class="anchor" id="autotoc_md798"></a>
Explanation of the raw dataset importer:</h1>
<p>The <em>RawDatasetImporter</em> imports raw datasets, where the data is stored sequentially. Some raw datasets contain a header where you can read information about how the data is stored (content format, dimension, etc.), while some datasets expect you to know the layout and format. The importer takes the following parameters:</p><ul>
<li>filePath: Filepath of the dataset</li>
<li>dimX: X-dimension (number of samples in the X-axis)</li>
<li>dimY: Y-dimension</li>
<li>dimZ: Z-dimension</li>
<li>contentFormat: Value type of the data (Int8, Uint8, Int16, Uint16, etc..)</li>
<li>skipBytes: Number of bytes to skip (offset to where the data begins). This is usually the same as the header size, and will be 0 if there is no header.</li>
</ul>
<p>All this info can be added to a ".ini"-file, which the importer will use (if it finds any). See the sample files (in the "DataFiles" folder for an example). </p>
<h1><a class="anchor" id="autotoc_md799"></a>
Todo:</h1>
<ul>
<li>Improve 2D Transfer Function editor: Better GUI, more shapes (triangles)</li>
<li>Optimise histogram generation</li>
<li>Support very large datasets (currently we naively try to create 3D textures with the same dimension as the data)</li>
</ul>
<p><img src="https://github.com/mlavik1/UnityVolumeRendering/blob/master/Screenshots/slices.gif" alt="alt tag" class="inline"/> <img src="https://github.com/mlavik1/UnityVolumeRendering/blob/master/Screenshots/1.png" alt="alt tag" class="inline"/> <img src="https://github.com/mlavik1/UnityVolumeRendering/blob/master/Screenshots/2.png" alt="alt tag" class="inline"/> <img src="https://github.com/mlavik1/UnityVolumeRendering/blob/master/Screenshots/3.png" alt="alt tag" class="inline"/> <img src="https://github.com/mlavik1/UnityVolumeRendering/blob/master/Screenshots/4.png" alt="alt tag" class="inline"/> <img src="https://github.com/mlavik1/UnityVolumeRendering/blob/master/Screenshots/5.png" alt="alt tag" class="inline"/> <img src="https://github.com/mlavik1/UnityVolumeRendering/blob/master/Screenshots/6.png" alt="alt tag" class="inline"/></p>
<p>See ACKNOWLEDGEMENTS.txt for libraries used by this project. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
